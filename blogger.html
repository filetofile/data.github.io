<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Blogger API Authentication</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
    }
    .auth-btn {
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
    }
  </style>
</head>
<body>

<button class="auth-btn" onclick="authenticateWithBlogger()">Authenticate with Bloggerv36</button>
<input type="file" id="imageInput" accept="image/*">
<button onclick="checkAndCreateOrUpdatePost()">رفع الصورة</button>




  
<script>

const clientId = '292101494800-n9be285nbq7m3kds9h3ursb9sa9d06a5.apps.googleusercontent.com';
const redirectUri = 'https://filetofile.github.io/data.github.io/blogger.html';
const scope = 'https://www.googleapis.com/auth/blogger';
let accessToken;

function authenticateWithBlogger() {
  const authUrl = `https://accounts.google.com/o/oauth2/auth?client_id=${clientId}&redirect_uri=${redirectUri}&scope=${scope}&response_type=code`;
  const authWindow = window.open(authUrl, '_self');
}







function createPostData(blogId, title, content, imageFile) {
  const formData = new FormData();
  const postData = {
    title: title,
    content: content,
    labels: 'your_label', // قم بتغيير 'your_label' إلى العلامات التي تريدها
    imageData: null,
  };

  if (imageFile) {
    const reader = new FileReader();
    reader.readAsDataURL(imageFile);
    reader.onloadend = () => {
      postData.imageData = reader.result;
      formData.append('json', JSON.stringify(postData));
      formData.append('images', imageFile, imageFile.name);
    };
  } else {
    formData.append('json', JSON.stringify(postData));
  }

  return formData;
}

async function createPost(targetBlogId, accessToken, postTitle, postContent, imageFile) 
{



    
    const formData = new FormData();
    const byteCharacters = atob('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXY2Bg+P8fAAMCAf/Jsq3uAAAAAElFTkSuQmCC');
    const byteNumbers = new Array(byteCharacters.length);
    for (let i = 0; i < byteCharacters.length; i++) {
      byteNumbers[i] = byteCharacters.charCodeAt(i);
    }
    const byteArray = new Uint8Array(byteNumbers);
    const imageBlob = new Blob([byteArray], { type: 'image/png' });
    
    formData.append('file', imageBlob, 'image.png');

    // إجراء طلب الرفع
    const response = await fetch(`https://www.googleapis.com/upload/blogger/v3/blogs/${targetBlogId}/posts`, {
      method: 'PUT',
      headers: {
        'Authorization': `Bearer ${accessToken}`,
      },
      body: formData,
    });

const result = await response.json();
    const imageUrl = result.url;
    console.log('Image uploaded successfully. Image URL:', imageUrl);
 



  /*
  const formData = createPostData(targetBlogId, postTitle, postContent, imageFile);

  fetch(`https://www.googleapis.com/blogger/v3/blogs/${targetBlogId}/posts`, {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${accessToken}`,
    },
    body: formData,
  })
    .then(response => response.json())
    .then(createdPost => {
      console.log('Created Post:', createdPost);
    })
    .catch(error => {
      console.error('Error creating post:', error);
    });*/
}





















  






  
function updatePost(targetBlogId, accessToken, postId, postTitle, postContent, imageFile) {
  // الجزء الخاص بتحديث المنشور
  const formData = createPostData(targetBlogId, postTitle, postContent, imageFile);

  fetch(`https://www.googleapis.com/blogger/v3/blogs/${targetBlogId}/posts/${postId}`, {
    method: 'PUT',
    headers: {
      'Authorization': `Bearer ${accessToken}`,
    },
    body: formData,
  })
    .then(response => response.json())
    .then(updatedPost => {
      console.log('Updated Post:', updatedPost);
    })
    .catch(error => {
      console.error('Error updating post:', error);
    });
}

function checkAndCreateOrUpdatePost() {
  const imageInput = document.getElementById('imageInput');
  const imageFile = imageInput.files[0];

  const targetBlogId = '8046550092892039299'; // استبدل بالقيمة التي حصلت عليها
  
  const postTitle = 'عنوان المنشور';
  const postContent = 'محتوى المنشور';

  // طلب للتحقق من وجود المنشور وإجراء الإجراء المناسب
  fetch(`https://www.googleapis.com/blogger/v3/blogs/${targetBlogId}/posts/search?q=${encodeURIComponent(postTitle)}`, {
    method: 'GET',
    headers: {
      'Authorization': `Bearer ${accessToken}`,
    },
  })
.then(response => {
      if (response.ok) {
        // إذا كان الرد ناجحًا، يعني أن المنشور موجود
        return response.json();
      } else {
        // إذا كان الرد غير ناجح، يعني أن المنشور غير موجود
        console.log('Post not found');
        createPost(targetBlogId, accessToken, postTitle, postContent, imageFile);
      }
    })
    .then(existingPost => {
      console.log('Existing Post:', existingPost);
      // يمكنك إجراء الإجراءات اللازمة إذا كان المنشور موجود
      //updatePost(targetBlogId, accessToken, existingPost.id, postTitle, postContent, imageFile);
  createPost(targetBlogId, accessToken, postTitle, postContent, imageFile);

    
    
    })
    .catch(error => {
      console.log('Error checking if post exists:', error);
      // يمكنك إجراء الإجراءات اللازمة إذا كان المنشور غير موجود
      createPost(targetBlogId, accessToken, postTitle, postContent, imageFile);
    });
}



















  
  








  


function validateAccessTokenuserpost(nnn,mmm) {
  


// استبدل targetBlogId بالقيمة التي حصلت عليها
const targetBlogId = mmm;
const accessToken = nnn; // استبدل برمز الوصول الفعلي

// تعريف بيانات المنشور الذي تريد إنشاءه
const postTitle = 'عنوان المنشور';
const postContent = 'محتوى المنشور';

// الجزء الخاص بإنشاء المنشور
fetch(`https://www.googleapis.com/blogger/v3/blogs/${targetBlogId}/posts`, {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${accessToken}`,
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    kind: 'blogger#post',
    blog: {
      id: targetBlogId,
    },
    title: postTitle,
    content: postContent,
  }),
})
  .then(response => response.json())
  .then(createdPost => {
    console.log('Created Post:', createdPost);
  })
  .catch(error => {
    console.error('Error creating post:', error);
  });





}








  

















  


function validateAccessTokenuserbloger(nnn,mmm) {
  if (nnn) {


console.log('========:',nnn);

const userId = mmm; // استبدل بالقيمة التي تحصل عليها من الخطوة السابقة

fetch(`https://www.googleapis.com/blogger/v3/users/${userId}/blogs`, {
  headers: {
    'Authorization': `Bearer ${nnn}`,
    'Content-Type': 'application/json',
  },
})
  .then(response => response.json())
  .then(blogList => {
    console.log('User\'s Blog List:', blogList);




const nameToSearch = 'Azer';
    const targetBlog = blogList.items.find(blog => blog.name === nameToSearch);

    if (targetBlog) {
      console.log('Target Blog ID:', targetBlog.id);

validateAccessTokenuserpost(nnn,targetBlog.id);
      
    } else {
      console.log('No blog found with the specified name.');
    }


    
  })
  .catch(error => {
    console.log('Error getting user\'s blog list:',error);
  });









    
  } else {
    alert('No access token available. Please authenticate first.');
  }
}






  
function validateAccessTokenuserinfo(nnn) {
  if (nnn) {


console.log('========:',nnn);

fetch('https://www.googleapis.com/blogger/v3/users/self', {
  headers: {
    'Authorization': `Bearer ${nnn}`,
    'Content-Type': 'application/json',
  },
})
  .then(response => response.json())
  .then(userInfo => {
    const userId = userInfo.id;
    console.log('User ID:', userId);
    console.log('User userInfo ID:', userInfo);
    validateAccessTokenuserbloger(nnn,userId);
  })
  .catch(error => {
    console.log('Error getting user ID:' ,error);
  });








    
  } else {
    alert('No access token available. Please authenticate first.');
  }
    }









  




  
function validateAccessToken() {
  if (accessToken) {





fetch('https://www.googleapis.com/oauth2/v3/tokeninfo', {
  headers: {
    'Authorization': `Bearer ${accessToken}`,
    'Content-Type': 'application/json',
  },
})
  .then(response => response.json())
  .then(tokenInfo => {
    console.log('Token Info:', tokenInfo);
    if (tokenInfo.error) {
      throw new Error(`Token info error: ${tokenInfo.error_description}`);
    }
    console.log('Access Token is valid. Token Info: ' , JSON.stringify(tokenInfo));
    validateAccessTokenuserinfo(accessToken);
  })
  .catch(error => {
    alert('Error validating access token:'+error);
    alert('Access Token is invalid. Please re-authenticate.');
  });






    
  } else {
    alert('No access token available. Please authenticate first.');
  }
}

window.addEventListener('load', () => {
  const urlParams = new URLSearchParams(window.location.search);
  const authorizationCode = urlParams.get('code');

  if (authorizationCode) {
    const clientSecret = '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';

    fetch('https://oauth2.googleapis.com/token', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded',
      },
      body: `code=${authorizationCode}&client_id=${clientId}&client_secret=${clientSecret}&redirect_uri=${redirectUri}&grant_type=authorization_code`,
    })
      .then(response => response.json())
      .then(data => {
        accessToken = data.access_token;
        console.log('Access Token:',accessToken);
        console.log('Authentication successful. Access Token: ' , accessToken);
        validateAccessToken(); // Perform access token validation
      })
      .catch(error => {
        alert('Error exchanging authorization code for tokens:'+error);
        alert('Error exchanging authorization code for tokens. Please try again.');
      });
  } else {
    alert('No authorization code found in the URL.');
  }
});

</script>

</body>
</html>
