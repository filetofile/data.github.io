<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Blogger API Authentication</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
    }
    .auth-btn {
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
    }
  </style>
</head>
<body>

<button class="auth-btn" onclick="authenticateWithBlogger()">Authenticate with Bloggerv76</button>
<input type="file" id="fileInput" accept="image/*" onchange="handleFileSelect()"  >
<button onclick="checkAndCreateOrUpdatePost()">رفع الصورة</button>
<label for="file">Select Image:</label>
  <input type="file" id="file" accept="image/*">
  <button id="sendRequestButton">Send Request</button>

<input type="file" id="fileInput" accept="image/*">
<button onclick="uploadImagee()">Upload Image</button>


  
<script>

const clientId = '840243792398-l3b6u0r2t189ughosmrp75gr78mtoc1k.apps.googleusercontent.com';
const redirectUri = 'https://filetofile.github.io/data.github.io/blogger.html';
const scope = 'https://www.googleapis.com/auth/blogger';
let accessToken;
let albumId;
let apiKey ='AIzaSyD45rWM9SqEeWw0p2ybyc-CLFov_zm6u38';





  
function authenticateWithBlogger() {
  
  
  
  
    const scope = 'https://www.googleapis.com/auth/photoslibrary'; // نطاق Google Photos API

  const authUrl = `https://accounts.google.com/o/oauth2/auth?client_id=${clientId}&redirect_uri=${redirectUri}&scope=${scope}&response_type=code`;
  const authWindow = window.open(authUrl, '_self');


  
  /*const authUrl = `https://accounts.google.com/o/oauth2/auth?client_id=${clientId}&redirect_uri=${redirectUri}&scope=${scope}&response_type=code`;
  const authWindow = window.open(authUrl, '_self');*/
}































function uploadImagee() {
  const fileInput = document.getElementById('fileInput');
  const file = fileInput.files[0];
  const blogId = '4165156656721311842';
  const postId = '5915191559681045274';

  if (file) {
    const xhr = new XMLHttpRequest();
    const apiUrl = `https://www.googleapis.com/blogger/v3/blogs/${blogId}/posts/${postId}`;
    //const boundary = '-------314159265358979323846';
    //const delimiter = `\r\n--${boundary}\r\n`;

    const reader = new FileReader();
    reader.onload = function(e) {
      const imageData = e.target.result.split(',')[1]; // Extract base64 data
      const contentType = file.type;

      const requestBody =
        
        'Content-Type: application/json;charset=UTF-8\r\n\r\n' +
        JSON.stringify({
          'kind': 'blogger#post',
          'id': postId,
          'images': [
            {
              'url': `data:${contentType};base64,${imageData}`,
              'isDraft': true
            }
          ]
        }) +
        
        `Content-Type: ${contentType}\r\n` +
        'Content-Transfer-Encoding: base64\r\n'+
        imageData;

      xhr.open('PUT', apiUrl, true);
      xhr.setRequestHeader('Authorization', `Bearer ${accessToken}`);
      xhr.setRequestHeader('Content-Type', `multipart/related`);

      xhr.onreadystatechange = function() {
        if (xhr.readyState === 4) {
          if (xhr.status === 200) {
            console.log('Image uploaded successfully.');
          } else {
            console.error('Failed to upload image:', xhr.responseText);
          }
        }
      };

      xhr.send(requestBody);
    };

    reader.readAsDataURL(file);
  } else {
    console.error('Please select an image file.');
  }
}




  

document.getElementById('sendRequestButton').addEventListener('click', function() {
      var fileInput = document.getElementById('file');
      if (fileInput.files.length > 0) {
        var file = fileInput.files[0];
        var fileReader = new FileReader();

        fileReader.onload = function(e) {
          var requestData = {
            method: 'PUT',
            absoluteURI: 'https://blogger.googleapis.com/v3/blogs/4165156656721311842/posts/6558468288551908668',
            headers: {
              'Authorization':  `Bearer ${accessToken}`,
              'Content-Type': 'application/json'
            },
            'message-body': '<p>&nbsp;e1hhhhhhhhudyhazjkz</p>',
            'media-body': e.target.result,
            'media-content-type': file.type
          };

          sendRequestt(requestData);
        };

fileReader.readAsDataURL(file);
      } else {
        // Handle case when no file is selected
        alert('Please select an image file.');
      }
    });


function sendRequestt(requestData) {
      var xhr = new XMLHttpRequest();
      xhr.open(requestData.method, requestData.absoluteURI, true);

      // Set headers
      for (var header in requestData.headers) {
        xhr.setRequestHeader(header, requestData.headers[header]);
      }

      xhr.onreadystatechange = function() {
        if (xhr.readyState === 4) {
          if (xhr.status === 200) {
            // Successful response
            var response = JSON.parse(xhr.responseText);
            console.log(response);
          } else {
            // Handle errors
            console.error('Error:', xhr.statusText);
          }
        }
      };

xhr.send(JSON.stringify({
        content: requestData['message-body'],
        media: {
          mediaType: requestData['media-content-type'],
          data: requestData['media-body'],
          isDraft: true
        }
      }));
  
}
  



  



function createPostData(blogId, title, content, imageFile) {
  const formData = new FormData();
  const postData = {
    title: title,
    content: content,
    labels: 'your_label', // قم بتغيير 'your_label' إلى العلامات التي تريدها
    imageData: null,
  };

  if (imageFile) {
    const reader = new FileReader();
    reader.readAsDataURL(imageFile);
    reader.onloadend = () => {
      postData.imageData = reader.result;
      formData.append('json', JSON.stringify(postData));
      formData.append('images', imageFile, imageFile.name);
    };
  } else {
    formData.append('json', JSON.stringify(postData));
  }

  return formData;
}

async function createPost(targetBlogId, accessToken, postTitle, postContent, imageFile) 
{



    
    const formData = new FormData();
    const byteCharacters = atob('iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXY2Bg+P8fAAMCAf/Jsq3uAAAAAElFTkSuQmCC');
  const byteNumbers = new Array(byteCharacters.length);
    for (let i = 0; i < byteCharacters.length; i++) {
      byteNumbers[i] = byteCharacters.charCodeAt(i);
    }
    const byteArray = new Uint8Array(byteNumbers);
    const imageBlob = new Blob([byteArray], { type: 'image/png' });
    
    formData.append('file', imageBlob, 'image.png');

    // إجراء طلب الرفع
    const response = await fetch(`https://www.googleapis.com/blogger/v3/blogs/${targetBlogId}/posts`, {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${accessToken}`,
      },
      body: formData,
    });

const result = await response.json();
    const imageUrl = result.url;
    console.log('Image uploaded successfully. Image URL:', imageUrl);
 



  /*
  const formData = createPostData(targetBlogId, postTitle, postContent, imageFile);

  fetch(`https://www.googleapis.com/blogger/v3/blogs/${targetBlogId}/posts`, {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${accessToken}`,
    },
    body: formData,
  })
    .then(response => response.json())
    .then(createdPost => {
      console.log('Created Post:', createdPost);
    })
    .catch(error => {
      console.error('Error creating post:', error);
    });*/
}





















  






  
function updatePost(targetBlogId, accessToken, postId, postTitle, postContent, imageFile) {
  // الجزء الخاص بتحديث المنشور
  const formData = createPostData(targetBlogId, postTitle, postContent, imageFile);

  fetch(`https://www.googleapis.com/blogger/v3/blogs/${targetBlogId}/posts/${postId}`, {
    method: 'PUT',
    headers: {
      'Authorization': `Bearer ${accessToken}`,
    },
    body: formData,
  })
    .then(response => response.json())
    .then(updatedPost => {
      console.log('Updated Post:', updatedPost);
    })
    .catch(error => {
      console.error('Error updating post:', error);
    });
}

function checkAndCreateOrUpdatePost() {
  const imageInput = document.getElementById('imageInput');
  const imageFile = imageInput.files[0];

  const targetBlogId = '8046550092892039299'; // استبدل بالقيمة التي حصلت عليها
  
  const postTitle = 'عنوان المنشور';
  const postContent = 'محتوى المنشور';

  // طلب للتحقق من وجود المنشور وإجراء الإجراء المناسب
  fetch(`https://www.googleapis.com/blogger/v3/blogs/${targetBlogId}/posts/search?q=${encodeURIComponent(postTitle)}`, {
    method: 'GET',
    headers: {
      'Authorization': `Bearer ${accessToken}`,
    },
  })
.then(response => {
      if (response.ok) {
        // إذا كان الرد ناجحًا، يعني أن المنشور موجود
        return response.json();
      } else {
        // إذا كان الرد غير ناجح، يعني أن المنشور غير موجود
        console.log('Post not found');
        createPost(targetBlogId, accessToken, postTitle, postContent, imageFile);
      }
    })
    .then(existingPost => {
      console.log('Existing Post:', existingPost);
      // يمكنك إجراء الإجراءات اللازمة إذا كان المنشور موجود
      //updatePost(targetBlogId, accessToken, existingPost.id, postTitle, postContent, imageFile);
  createPost(targetBlogId, accessToken, postTitle, postContent, imageFile);

    
    
    })
    .catch(error => {
      console.log('Error checking if post exists:', error);
      // يمكنك إجراء الإجراءات اللازمة إذا كان المنشور غير موجود
      createPost(targetBlogId, accessToken, postTitle, postContent, imageFile);
    });
}



















  
  
/*
const API_KEY = 'YOUR_API_KEY';
const BLOG_ID = 'YOUR_BLOG_ID';
const accessToken = 'YOUR_ACCESS_TOKEN'; // Ensure you have the correct access token

const url = `https://www.googleapis.com/blogger/v3/blogs/${BLOG_ID}/posts`;
const headers = {
  'Authorization': `Bearer ${accessToken}`,
  'Content-Type': 'application/json'
};

const requestBody = {
  "content": "<p>&nbsp;niaDjdhhhhhhhhhudyhazjkz</p>",
  "title": "",
  "images": [
    {
      "url": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXY2Bg+P8fAAMCAf/Jsq3uAAAAAElFTkSuQmCC",
      "isDraft": true
    }
  ]
};

fetch(url, {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${accessToken}`,
    'Content-Type': 'application/json',
  },
  body: JSON.stringify(requestBody),
})
  .then(response => {
    if (!response.ok) {
      throw new Error(`HTTP error! Status: ${response.status}`);
    }
    return response.json();
  })
  .then(data => {
    console.log(data);
    // Handle the response here
  })
  .catch(error => {
    console.error('Error:', error.message);
  });




*/











function aplus(nnn,mmm) {
  
















const url = `https://blogger.googleapis.com/v3/blogs/4165156656721311842/posts/5915191559681045274`;
const headers = {
  'Authorization': `Bearer ${accessToken}`,
  'Content-Type': 'application/json'
};

const requestBody = {
  "content": "<p>&nbsp;niaDjdhhhhhhhhhudyhazjkz</p>",
  "title": "",
  "images": [
    {
      "url": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXY2Bg+P8fAAMCAf/Jsq3uAAAAAElFTkSuQmCC",
      "isDraft": true
    }
  ]
};

fetch(url, {
  method: 'PUT',
  headers: {
    'Authorization': `Bearer ${accessToken}`,
    'Content-Type': 'application/json',
  },
  body: JSON.stringify(requestBody),
})
  .then(response => {
    if (!response.ok) {
      throw new Error(`HTTP error! Status: ${response.status}`);
    }
    return response.json();
  })
  .then(data => {
    console.log(data);
    // Handle the response here
  })
  .catch(error => {
    console.error('Error:', error.message);
  });




}























  


function validateAccessTokenuserpost(nnn,mmm) {
  



const url = `https://blogger.googleapis.com/v3/blogs/4165156656721311842/posts/6558468288551908668`;
const headers = {
  'Authorization': `Bearer ${accessToken}`,
  'Content-Type': 'application/json'
};

const requestBody = {
  "content": "<p>&nbsp;niaDjdhhhhhhhhhudyhazjkz</p>",
  "title": "",
  "media": {
    "mediaType": "image/png",
    "data": "iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXY2Bg+P8fAAMCAf/Jsq3uAAAAAElFTkSuQmCC",
    "isDraft": true
  }
};

fetch(url, {
  method: 'PUT',
  headers: headers,
  body: JSON.stringify(requestBody),
})
  .then(response => {
    if (!response.ok) {
      throw new Error(`HTTP error! Status: ${response.status}`);
    }
    return response.json();
  })
  .then(data => {
    console.log(data);
    // Handle the response here
  })
  .catch(error => {
    console.error('Error:', error.message);
  });


















  
/*

// الصورة التي تريد رفعها
const imageBase64 = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXY2Bg+P8fAAMCAf/Jsq3uAAAAAElFTkSuQmCC';


  const apiUrl = `https://www.googleapis.com/upload/blogger/v3/blogs/4165156656721311842/posts/6558468288551908668/upload`;

  const requestData = {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${accessToken}`,
      'Content-Type': 'image/png', // تعديل نوع الصورة حسب الحاجة
    },
    mode: 'no-cors',
    body: imageBase64,
  };

  fetch(apiUrl, requestData)
    .then(response => response.json())
    .then(data => {
      console.log('تم رفع الصورة:', data);
       //aplus(nnn,mmm);
    })
    .catch(error => {
      console.error('حدث خطأ أثناء رفع الصورة:', error);
       //aplus(nnn,mmm);
    });


*/






/*
const url = `https://blogger.googleapis.com/v3/blogs/4165156656721311842/posts/6558468288551908668`;
const headers = {
  'Authorization': `Bearer ${accessToken}`,
  'Content-Type': 'application/json'
};

const requestBody = {
  "content": "<p>&nbsp;niaDjdhhhhhhhhhudyhazjkz</p>",
  "title": "",
  "images": [
    {
      "url": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXY2Bg+P8fAAMCAf/Jsq3uAAAAAElFTkSuQmCC",
      "isDraft": true
    }
  ]
};

fetch(url, {
  method: 'PUT',
  headers: {
    'Authorization': `Bearer ${accessToken}`,
    'Content-Type': 'application/json',
  },
  body: JSON.stringify(requestBody),
})
  .then(response => {
    if (!response.ok) {
      throw new Error(`HTTP error! Status: ${response.status}`);
    }
    return response.json();
  })
  .then(data => {
    console.log(data);
    // Handle the response here
  })
  .catch(error => {
    console.error('Error:', error.message);
  });



*/





/*

  
const targetBlogId = mmm;
const accessToken = nnn; 

  const postTitle = '6gygg';
const postContent = 'azer';

// ط§ظ„ط¬ط²ط، ط§ظ„ط®ط§طµ ط¨ط¥ظ†ط´ط§ط، ط§ظ„ظ…ظ†ط´ظˆط±
fetch(`https://www.googleapis.com/blogger/v3/blogs/${targetBlogId}/posts`, {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${accessToken}`,
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    kind: 'blogger#post',
    blog: {
      id: targetBlogId,
    },
    title: postTitle,
    content: postContent,
  }),
})
  .then(response => response.json())
  .then(createdPost => {
    console.log('Created Post:', createdPost);
  })
  .catch(error => {
    console.error('Error creating post:', error);
  });

*/



}





  

















  


function validateAccessTokenuserbloger(nnn,mmm) {
  if (nnn) {


console.log('========:',nnn);

const userId = mmm; // استبدل بالقيمة التي تحصل عليها من الخطوة السابقة

fetch(`https://www.googleapis.com/blogger/v3/users/${userId}/blogs`, {
  headers: {
    'Authorization': `Bearer ${nnn}`,
    'Content-Type': 'application/json',
  },
})
  .then(response => response.json())
  .then(blogList => {
    console.log('User\'s Blog List:', blogList);




const nameToSearch = 'Azer';
    const targetBlog = blogList.items.find(blog => blog.name === nameToSearch);

    if (targetBlog) {
      console.log('Target Blog ID:', targetBlog.id);

validateAccessTokenuserpost(nnn,targetBlog.id);
      
    } else {
      console.log('No blog found with the specified name.');
    }


    
  })
  .catch(error => {
    console.log('Error getting user\'s blog list:',error);
  });









    
  } else {
    alert('No access token available. Please authenticate first.');
  }
}





/*
  
function validateAccessTokenuserinfo(nnn) {
  if (nnn) {


console.log('========:',nnn);

fetch('https://www.googleapis.com/blogger/v3/users/self', {
  headers: {
    'Authorization': `Bearer ${nnn}`,
    'Content-Type': 'application/json',
  },
})
  .then(response => response.json())
  .then(userInfo => {
    const userId = userInfo.id;
    console.log('User ID:', userId);
    console.log('User userInfo ID:', userInfo);
    validateAccessTokenuserbloger(nnn,userId);
  })
  .catch(error => {
    console.log('Error getting user ID:' ,error);
  });








    
  } else {
    alert('No access token available. Please authenticate first.');
  }
    }


*/
function addImageToAlbum(albumId, uploadToken) {
  fetch('https://photoslibrary.googleapis.com/v1/mediaItems:batchCreate', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${accessToken}`,
    },
    body: JSON.stringify({
      albumId: albumId,
      newMediaItems: [{ description: 'Image description', simpleMediaItem: { uploadToken: uploadToken } }],
    }),
  })
  .then(response => response.json())
  .then(addImageData => {
    console.log('Image added to album:', addImageData);
    // يمكنك إجراء مزيد من الإجراءات حسب الحاجة
  })
  .catch(error => console.error('Error adding image to album:', error));
}
function uploadImageAndGetToken(imageBlob) {
  return fetch(`https://photoslibrary.googleapis.com/v1/uploads?key=${apiKey}`, {
    method: 'POST',
    body: imageBlob,
    headers: {
      'Content-Type': 'application/octet-stream',
      'Authorization': `Bearer ${accessToken}`,
    },
  })
  .then(response => response.text())
  .then(uploadData => uploadData)
  .catch(error => console.error('Error uploading image:', error));
}

function uploadAndAddToAlbum(imageBlob) {
  uploadImageAndGetToken(imageBlob)
    .then(uploadData => {
      const imageToken = uploadData;
      addImageToAlbum(albumId, imageToken);
    })
    .catch(error => console.error('Error uploading image and adding to album:', error));
    }

function handleFileSelect() {
  const fileInput = document.getElementById('fileInput');
  const selectedFile = fileInput.files[0];

  if (selectedFile) {
    // يمكنك قراءة الملف أو تحميله أو استخدامه بالطريقة التي تحتاجها
    // هنا، يتم استخدام FileReader كمثال بسيط لقراءة الملف كـ Blob

    const reader = new FileReader();
    reader.onloadend = function () {
      const imageBlob = new Blob([reader.result], { type: selectedFile.type });
      // الآن يمكنك استخدام imageBlob للقيام بالخطوات المطلوبة
      // مثال: الحصول على توكن الوصول ورفع الصورة إلى الألبوم
      uploadAndAddToAlbum(imageBlob);
      
      // يمكنك استخدام albumData.id لإضافة الصورة إلى الألبوم
    };

    reader.readAsArrayBuffer(selectedFile);
  }
}



      
  function createAlbum(albumTitle, accessToken) {
  fetch('https://photoslibrary.googleapis.com/v1/albums', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${accessToken}`,
    },
    body: JSON.stringify({
      album: { title: albumTitle },
    }),
  })
  .then(response => response.json())
  .then(albumData => {
    console.log('Album created:', albumData);
    albumId = albumData.id;
    // يمكنك استخدام albumData.id لاحقًا لإضافة الصور إليه
  })
  .catch(error => console.error('Error creating album:', error));
  }

function checkAlbumExists(albumTitle, accessToken) {
  fetch('https://photoslibrary.googleapis.com/v1/albums', {
    method: 'GET',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${accessToken}`,
    },
  })
  .then(response => response.json())
  .then(albumsData => {
    const existingAlbum = albumsData.albums.find(album => album.title === albumTitle);

    if (existingAlbum) {
      albumId = existingAlbum.id;
      console.log('Album already exists:', existingAlbum);
      
      // يمكنك اتخاذ إجراءات إضافية حسب الحاجة
    } else {
      console.log('Album does not exist. Creating it...');
      // استدعاء وظيفة إنشاء الألبوم هنا
      createAlbum(albumTitle, accessToken);
    }
  })
  .catch(error => console.error('Error checking album existence:', error));
  }




  




  
function validateAccessToken() {
  if (accessToken) {





fetch('https://www.googleapis.com/oauth2/v3/tokeninfo', {
  headers: {
    'Authorization': `Bearer ${accessToken}`,
    'Content-Type': 'application/json',
  },
})
  .then(response => response.json())
  .then(tokenInfo => {
    console.log('Token Info:', tokenInfo);
    if (tokenInfo.error) {
      throw new Error(`Token info error: ${tokenInfo.error_description}`);
    }
    console.log('Access Token is valid. Token Info: ' , JSON.stringify(tokenInfo));
    //validateAccessTokenuserinfo(accessToken);
    checkAlbumExists("azertyuiopqs", accessToken);
  })
  .catch(error => {
    alert('Error validating access token:'+error);
    alert('Access Token is invalid. Please re-authenticate.');
  });






    
  } else {
    alert('No access token available. Please authenticate first.');
  }
}

window.addEventListener('load', () => {
  const urlParams = new URLSearchParams(window.location.search);
  const authorizationCode = urlParams.get('code');

  if (authorizationCode) {
    const clientSecret = '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';

    fetch('https://oauth2.googleapis.com/token', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded',
      },
      body: `code=${authorizationCode}&client_id=${clientId}&client_secret=${clientSecret}&redirect_uri=${redirectUri}&grant_type=authorization_code`,
    })
      .then(response => response.json())
      .then(data => {
        accessToken = data.access_token;
        console.log('Access Token:',accessToken);
        console.log('Authentication successful. Access Token: ' , accessToken);
        validateAccessToken(); // Perform access token validation
      })
      .catch(error => {
        alert('Error exchanging authorization code for tokens:'+error);
        alert('Error exchanging authorization code for tokens. Please try again.');
      });
  } else {
    alert('No authorization code found in the URL.');
  }
});

</script>

</body>
</html>
