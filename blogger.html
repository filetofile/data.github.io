<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Blogger API Authentication</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
  </style>
</head>
<body>

  V16
  <h1>Blogger API Authentication</h1>

  <button onclick="authenticate()">Authenticate</button>
  <input type="file" id="image-upload" accept="image/*" />


  <script>
    const clientId = '574488240288-fs9u6ccs51ee1djoam3em5p98rsft7fl.apps.googleusercontent.com';
    const clientSecret = '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';
    const redirectUri = 'https://filetofile.github.io/data.github.io/blogger.html';
    const scope = 'https://www.googleapis.com/auth/blogger';
    let accessToken;
    let userId;
    let blogId;
    let postId = 8358746716108557629;

/*
document.getElementById("image-upload").addEventListener("change", function(event) {
  var file = event.target.files[0];

  // تأكد من أن الملف هو صورة
  if (!file.type.startsWith("image/")) {
    alert("Please select an image file.");
    return;
  }

  // اقرأ الملف كبيانات ثنائية
  var reader = new FileReader();
  reader.onload = function(event) {
    var imageData = event.target.result;

    // استخدم Blogger API v3 لرفع الصورة
    uploadImage(imageData);
  };
  reader.readAsBinaryString(file);
});


function uploadImage(imageData) {
  var request = new XMLHttpRequest();
  request.open("POST", "https://www.googleapis.com/blogger/v3/blogs/" + blogId + "/posts/" + 8358746716108557629 + "/media");
  request.setRequestHeader("Authorization", "Bearer " + accessToken);
  request.setRequestHeader("Content-Type", "image/jpeg");
  request.send(imageData);

  request.onload = function() {
    if (request.status === 200) {
      console.log("Image uploaded successfully!");
    } else {
      console.log(request.responseText);
    }
  };
}

*/
    document.getElementById("image-upload").addEventListener("change", function(event) {
  var file = event.target.files[0];

  // استدعاء وظيفة uploadImage
  uploadImage(file, blogId, postId, accessToken);
});

function uploadImage(file, blogId, postId, accessToken) {
  // تأكد من أن الملف هو صورة
  if (!file.type.startsWith("image/")) {
    console.log("Please select an image file.");
    return;
  }

  // إنشاء طلب XMLHttpRequest
  var request = new XMLHttpRequest();
  request.open("POST","https://www.tunnelhidetotom.com.global.prod.fastly.net/blogger/v3/blogs/{blogId}/posts/{postId}/media");
  request.setRequestHeader("Authorization", "Bearer " + accessToken);
  request.setRequestHeader("Content-Type", file.type);

  // إرسال طلب XMLHttpRequest
  request.send(file);

  // معالجة استجابة XMLHttpRequest
  request.onload = function() {
    if (request.status === 200) {
      console.log("Image uploaded successfully!");
      var response = JSON.parse(request.responseText);
      var imageUrl = response.url;

      // اعرض الصورة في منشور المدونة
      // ...

    } else {
      console.log(request.responseText);
    }
  };
}








    
    function authenticate() {
      const authUrl = `https://accounts.google.com/o/oauth2/auth?client_id=${clientId}&redirect_uri=${redirectUri}&scope=${scope}&response_type=code`;
  const authWindow = window.open(authUrl, '_self');
    }

    function validateAccessTokenuserbloger() {
 

        fetch(`https://www.googleapis.com/blogger/v3/users/${userId}/blogs`, {
          headers: {
            'Authorization': `Bearer ${accessToken}`,
            'Content-Type': 'application/json',
          },
        })
          .then(response => response.json())
          .then(blogList => {
            console.log('User\'s Blog List:', blogList);
            const nameToSearch = 'Azer';
            const targetBlog = blogList.items.find(blog => blog.name === nameToSearch);

            if (targetBlog) {
              console.log('Target Blog ID:', targetBlog.id);
              blogId = targetBlog.id;
              validateAccessTokenuserpost(accessToken, targetBlog.id);
            } else {
              console.log('No blog found with the specified name.');
            }
          })
          .catch(error => {
            console.log('Error getting user\'s blog list:', error);
          });
    }

    function validateAccessTokenuserpost(accessToken, blogId) {
      
        fetch(`https://www.googleapis.com/blogger/v3/blogs/${blogId}/posts`, {
          headers: {
            'Authorization': `Bearer ${accessToken}`,
            'Content-Type': 'application/json',
          },
        })
          .then(response => response.json())
          .then(postList => {
            console.log('Blog\'s Post List:', postList);
            // Perform additional actions with the postList
          })
          .catch(error => {
            console.log('Error getting blog\'s post list:', error);
          });
      
      
    }



















function validateAccessTokenuserinfo() {


fetch('https://www.googleapis.com/blogger/v3/users/self', {
  headers: {
    'Authorization': `Bearer ${accessToken}`,
    'Content-Type': 'application/json',
  },
})
  .then(response => response.json())
  .then(userInfo => {
    userId = userInfo.id;
    alert('User ID:'+ userId);
    alert('User userInfo ID:'+ userInfo);
   validateAccessTokenuserbloger();
  })
  .catch(error => {
    console.log('Error getting user ID:' ,error);
  });
  
  }
    
















    
    function validateAccessToken() {
      if (accessToken) {
        fetch('https://www.googleapis.com/oauth2/v3/tokeninfo', {
          headers: {
            'Authorization': `Bearer ${accessToken}`,
            'Content-Type': 'application/json',
          },
        })
          .then(response => response.json())
          .then(tokenInfo => {
            alert('Token Info:'+ tokenInfo);
            if (tokenInfo.error) {
              throw new Error(`Token info error: ${tokenInfo.error_description}`);
            }
            alert('Access Token is valid. Token Info: '+ JSON.stringify(tokenInfo));
            validateAccessTokenuserinfo();
            
          })
          .catch(error => {
            alert('Error validating access token:' + error);
            alert('Access Token is invalid. Please re-authenticate.');
          });
      } else {
        alert('No access token available. Please authenticate first.');
      }
    }

    window.addEventListener('load', () => {
      const urlParams = new URLSearchParams(window.location.search);
      const authorizationCode = urlParams.get('code');

      if (authorizationCode) {
        fetch('https://oauth2.googleapis.com/token', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
          },
          body: `code=${authorizationCode}&client_id=${clientId}&client_secret=${clientSecret}&redirect_uri=${redirectUri}&grant_type=authorization_code`,
        })
          .then(response => response.json())
          .then(data => {
            accessToken = data.access_token;
            alert('Access Token:'+ accessToken);
            alert('Authentication successful. Access Token: ' + JSON.stringify(accessToken));
            validateAccessToken();
          })
          .catch(error => {
            alert('Error exchanging authorization code for tokens:' + error);
            alert('Error exchanging authorization code for tokens. Please try again.');
          });
      } else {
        alert('No authorization code found in the URL.');
      }
    });


    
  </script>
</body>
</html>
